# ChatX åç«¯ API

åŸºäº FastAPI çš„ç°ä»£åŒ–åç«¯æœåŠ¡ï¼Œé›†æˆäº†ç”¨æˆ·è®¤è¯ã€æ–‡ä»¶ç®¡ç†ã€å‘é‡æœç´¢ç­‰åŠŸèƒ½ã€‚

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

- **Web æ¡†æ¶**: FastAPI 
- **åå‘ä»£ç†**: Nginx (ç»Ÿä¸€å…¥å£ã€è´Ÿè½½å‡è¡¡ã€SSLç»ˆç»“)
- **æ•°æ®åº“**: PostgreSQL (ç”¨æˆ·æ•°æ®ã€ç»“æ„åŒ–æ•°æ®)
- **ç¼“å­˜**: Redis (ä¼šè¯ç®¡ç†ã€ç¼“å­˜ä¼˜åŒ–)
- **å¼‚æ­¥ä»»åŠ¡**: Celery (å®šæ—¶ä»»åŠ¡ã€å¼‚æ­¥å¤„ç†)
- **æ–‡ä»¶å­˜å‚¨**: MinIO (ç”¨æˆ·æ–‡ä»¶ã€åª’ä½“èµ„æº)
- **å‘é‡æ•°æ®åº“**: Weaviate (å‘é‡æœç´¢ã€è¯­ä¹‰æ£€ç´¢)
- **çŸ¥è¯†å›¾è°±**: Neo4j (å…³ç³»åˆ†æã€å›¾ç®—æ³•)
- **å®¹å™¨åŒ–**: Docker & Docker Compose

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Docker å’Œ Docker Compose
- Python 3.11+ (å¦‚éœ€æœ¬åœ°å¼€å‘)

### ä¸€é”®å¯åŠ¨

```bash
# å…‹éš†é¡¹ç›®åè¿›å…¥åç«¯ç›®å½•
cd backend

# ç»™å¯åŠ¨è„šæœ¬æ‰§è¡Œæƒé™
chmod +x start.sh

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
./start.sh
```

### æ‰‹åŠ¨å¯åŠ¨

**å¼€å‘ç¯å¢ƒ**:

1. **ç¯å¢ƒé…ç½®**
```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶
cp .env.example .env

# æ ¹æ®éœ€è¦ä¿®æ”¹ .env æ–‡ä»¶ä¸­çš„é…ç½®
```

2. **å¯åŠ¨æœåŠ¡**
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up --build -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

**ç”Ÿäº§ç¯å¢ƒ**:

1. **ç”Ÿäº§ç¯å¢ƒå¯åŠ¨**
```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x start-prod.sh

# å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ (åŒ…å« SSL å’Œä¼˜åŒ–é…ç½®)
./start-prod.sh
```

2. **æ‰‹åŠ¨ç”Ÿäº§å¯åŠ¨**
```bash
# ç”Ÿæˆ SSL è¯ä¹¦
chmod +x generate-ssl.sh
./generate-ssl.sh

# å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up --build -d
```

## ğŸ“‹ æœåŠ¡è¯´æ˜

### æ ¸å¿ƒæœåŠ¡

| æœåŠ¡ | å†…éƒ¨ç«¯å£ | å¤–éƒ¨è®¿é—® | è¯´æ˜ |
|------|---------|---------|------|
| Nginx | 80/443 | âœ… | åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ |
| FastAPI åº”ç”¨ | 8000 | ğŸš« | é€šè¿‡ Nginx è®¿é—® |
| PostgreSQL | 5432 | âœ… | å…³ç³»å‹æ•°æ®åº“ |
| Redis | 6379 | âœ… | ç¼“å­˜å’Œä¼šè¯å­˜å‚¨ |
| MinIO | 9000/9001 | âœ… | å¯¹è±¡å­˜å‚¨æœåŠ¡ |
| Neo4j | 7474/7687 | âœ… | çŸ¥è¯†å›¾è°±æ•°æ®åº“ |
| Weaviate | 8080 | âœ… | å‘é‡æ•°æ®åº“ |
| Celery Worker | - | ğŸš« | å¼‚æ­¥ä»»åŠ¡å¤„ç† |
| Celery Beat | - | ğŸš« | å®šæ—¶ä»»åŠ¡è°ƒåº¦ |

### ğŸŒ ç»Ÿä¸€å…¥å£åœ°å€ (æ¨è)

é€šè¿‡ Nginx åå‘ä»£ç†è®¿é—®æ‰€æœ‰æœåŠ¡ï¼š

- **ğŸ  ä¸»é¡µ**: http://localhost
- **ğŸ“– API æ–‡æ¡£**: http://localhost/docs
- **ğŸ”— API æ¥å£**: http://localhost/api/*
- **ğŸ“¦ MinIO æ§åˆ¶å°**: http://localhost/minio
- **ğŸ•¸ï¸ Neo4j æµè§ˆå™¨**: http://localhost/neo4j
- **ğŸ” Weaviate æ§åˆ¶å°**: http://localhost/weaviate

### ğŸ”§ ç›´è¿åœ°å€ (å¼€å‘è°ƒè¯•)

- **PostgreSQL**: localhost:5432 (ç”¨æˆ·å: `chatx_user`, å¯†ç : `chatx_password`)
- **Redis**: localhost:6379
- **MinIO API**: localhost:9000
- **Neo4j Bolt**: localhost:7687
- **Weaviate API**: localhost:8080

## ğŸ” API åŠŸèƒ½

### ç”¨æˆ·è®¤è¯

- âœ… ç”¨æˆ·æ³¨å†Œ/ç™»å½•
- âœ… JWT è®¿é—®ä»¤ç‰Œ + åˆ·æ–°ä»¤ç‰Œ
- âœ… å¯†ç å¼ºåº¦éªŒè¯
- âœ… ç”¨æˆ·ä¼šè¯ç®¡ç†
- âœ… é‚®ç®±éªŒè¯ (é¢„ç•™æ¥å£)
- âœ… å¯†ç é‡ç½® (é¢„ç•™æ¥å£)

### ç”¨æˆ·ç®¡ç†

- âœ… ç”¨æˆ·ä¿¡æ¯ CRUD
- âœ… ç”¨æˆ·æƒé™æ§åˆ¶
- âœ… ç”¨æˆ·å¤´åƒä¸Šä¼ 
- âœ… æ´»è·ƒçŠ¶æ€ç®¡ç†

### æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ

**ğŸ“ åŸºç¡€æ–‡ä»¶æ“ä½œ**
- âœ… æ–‡ä»¶ä¸Šä¼  (å•ä¸ª/æ‰¹é‡ï¼Œæœ€å¤§20ä¸ªæ–‡ä»¶)
- âœ… æ–‡ä»¶ä¸‹è½½ (æµå¼ä¸‹è½½ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ )
- âœ… æ–‡ä»¶åˆ é™¤ (è½¯åˆ é™¤/ç¡¬åˆ é™¤)
- âœ… æ–‡ä»¶é¢„è§ˆå’Œè¯¦æƒ…æŸ¥çœ‹
- âœ… æ–‡ä»¶é‡å‘½åå’Œæ›´æ–°
- âœ… æ–‡ä»¶å»é‡ (åŸºäºSHA256å“ˆå¸Œ)

**ğŸ“‚ æ–‡ä»¶å¤¹ç®¡ç†**
- âœ… å±‚çº§æ–‡ä»¶å¤¹ç»“æ„
- âœ… æ–‡ä»¶å¤¹åˆ›å»º/æ›´æ–°/åˆ é™¤
- âœ… æ–‡ä»¶å¤¹æ ‘å½¢å¯¼èˆª
- âœ… æ–‡ä»¶å¤¹æƒé™ç»§æ‰¿

**ğŸ·ï¸ æ™ºèƒ½åˆ†ç±»ç³»ç»Ÿ**
- âœ… 11ç§æ–‡ä»¶ç±»å‹è‡ªåŠ¨è¯†åˆ« (æ–‡æ¡£ã€å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ã€PDFã€ä»£ç ã€è¡¨æ ¼ã€æ¼”ç¤ºæ–‡ç¨¿ç­‰)
- âœ… è‡ªå®šä¹‰åˆ†ç±»ç®¡ç† (æ”¯æŒå±‚çº§åˆ†ç±»)
- âœ… åˆ†ç±»é¢œè‰²å’Œå›¾æ ‡è®¾ç½®
- âœ… åˆ†ç±»ç»Ÿè®¡å’Œæ–‡ä»¶è®¡æ•°

**ğŸ”– æ ‡ç­¾ç®¡ç†**
- âœ… å¤šæ ‡ç­¾å…³è” (ä¸€ä¸ªæ–‡ä»¶å¯æœ‰å¤šä¸ªæ ‡ç­¾)
- âœ… æ ‡ç­¾è‡ªåŠ¨åˆ›å»ºå’Œå¤ç”¨
- âœ… æ ‡ç­¾ä½¿ç”¨é¢‘ç‡ç»Ÿè®¡
- âœ… çƒ­é—¨æ ‡ç­¾æ¨è
- âœ… æ‰¹é‡æ ‡ç­¾æ“ä½œ

**ğŸ” é«˜çº§æœç´¢**
- âœ… å…³é”®è¯å…¨æ–‡æœç´¢ (æ–‡ä»¶åã€æ ‡é¢˜ã€æè¿°ã€æ ‡ç­¾)
- âœ… å¤šç»´åº¦è¿‡æ»¤ (ç±»å‹ã€å¤§å°ã€æ—¶é—´ã€åˆ†ç±»ã€æ ‡ç­¾)
- âœ… æ™ºèƒ½æ’åº (æ—¶é—´ã€å¤§å°ã€ä¸‹è½½é‡ã€æŸ¥çœ‹æ¬¡æ•°)
- âœ… åˆ†é¡µæµè§ˆå’Œæ— é™æ»šåŠ¨

**ğŸ‘¥ æ–‡ä»¶åˆ†äº«**
- âœ… åˆ†äº«é“¾æ¥ç”Ÿæˆ (æ”¯æŒè¿‡æœŸæ—¶é—´)
- âœ… å¯†ç ä¿æŠ¤åˆ†äº«
- âœ… è®¿é—®æƒé™æ§åˆ¶ (åªè¯»ã€ç¼–è¾‘ã€ç®¡ç†å‘˜)
- âœ… åˆ†äº«ç»Ÿè®¡å’Œè®¿é—®è®°å½•
- âœ… æ‰¹é‡åˆ†äº«ç®¡ç†

**ğŸ“Š ç»Ÿè®¡å’Œåˆ†æ**
- âœ… ç”¨æˆ·æ–‡ä»¶ç»Ÿè®¡ (æ€»æ•°ã€å¤§å°ã€é…é¢ä½¿ç”¨)
- âœ… æ–‡ä»¶ç±»å‹åˆ†å¸ƒåˆ†æ
- âœ… çƒ­é—¨æ–‡ä»¶å’Œæœ€è¿‘ä¸Šä¼ 
- âœ… ç”¨æˆ·æ´»åŠ¨è®°å½•å’Œæ“ä½œæ—¥å¿—
- âœ… å­˜å‚¨ç©ºé—´ç®¡ç†

**ğŸ” æƒé™å’Œå®‰å…¨**
- âœ… ç»†ç²’åº¦æƒé™æ§åˆ¶ (æ‰€æœ‰è€…ã€è¯»å–ã€å†™å…¥ã€ç®¡ç†å‘˜)
- âœ… æ–‡ä»¶å¯è§æ€§è®¾ç½® (ç§æœ‰ã€å†…éƒ¨ã€å…±äº«ã€å…¬å¼€)
- âœ… è®¿é—®æ—¥å¿—è®°å½• (IPã€ç”¨æˆ·ä»£ç†ã€æ“ä½œç±»å‹)
- âœ… æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒ (SHA256)
- âœ… å®‰å…¨æ–‡ä»¶ç±»å‹æ£€æŸ¥

**ğŸ”§ ä¼ä¸šçº§ç‰¹æ€§**
- âœ… æ–‡ä»¶ç‰ˆæœ¬ç®¡ç† (å†å²ç‰ˆæœ¬ä¿å­˜)
- âœ… æ–‡ä»¶è¯„è®ºå’Œåä½œ
- âœ… æ‰¹é‡æ“ä½œæ”¯æŒ
- âœ… æ–‡ä»¶æ´»åŠ¨æ—¶é—´çº¿
- âœ… å¼‚æ­¥å¤„ç†å’Œé˜Ÿåˆ—
- âœ… å‘é‡æœç´¢é›†æˆ (æ–‡æ¡£å†…å®¹æœç´¢)
- âœ… çŸ¥è¯†å›¾è°±å…³è” (Neo4jå›¾æ•°æ®åº“)

### å‘é‡æœç´¢

- âœ… å‘é‡æ•°æ®å­˜å‚¨
- âœ… è¯­ä¹‰æœç´¢  
- âœ… æ–‡æ¡£ç´¢å¼•ç®¡ç†
- âœ… ç›¸ä¼¼æ€§æœç´¢

## ğŸ“‹ API æ¥å£æ–‡æ¡£

### ğŸ” è®¤è¯æ¥å£ `/api/auth`

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | æƒé™ |
|------|------|------|------|
| POST | `/register` | ç”¨æˆ·æ³¨å†Œ | å…¬å¼€ |
| POST | `/login` | ç”¨æˆ·ç™»å½• | å…¬å¼€ |
| POST | `/refresh` | åˆ·æ–°è®¿é—®ä»¤ç‰Œ | éœ€è¦åˆ·æ–°ä»¤ç‰Œ |
| POST | `/logout` | ç”¨æˆ·é€€å‡º | éœ€è¦è®¤è¯ |
| POST | `/forgot-password` | å¿˜è®°å¯†ç  | å…¬å¼€ |
| POST | `/reset-password` | é‡ç½®å¯†ç  | éœ€è¦é‡ç½®ä»¤ç‰Œ |

### ğŸ‘¥ ç”¨æˆ·ç®¡ç† `/api/users`

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | æƒé™ |
|------|------|------|------|
| GET | `/me` | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ | éœ€è¦è®¤è¯ |
| PUT | `/me` | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ | éœ€è¦è®¤è¯ |
| POST | `/upload-avatar` | ä¸Šä¼ ç”¨æˆ·å¤´åƒ | éœ€è¦è®¤è¯ |
| GET | `/profile/{user_id}` | è·å–ç”¨æˆ·èµ„æ–™ | éœ€è¦è®¤è¯ |
| GET | `/` | è·å–ç”¨æˆ·åˆ—è¡¨ | ç®¡ç†å‘˜ |

### ğŸ“ æ–‡ä»¶ç®¡ç† `/api/files`

**æ–‡ä»¶æ“ä½œ**

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | æƒé™ |
|------|------|------|------|
| POST | `/upload` | å•æ–‡ä»¶ä¸Šä¼  | éœ€è¦è®¤è¯ |
| POST | `/upload-multiple` | æ‰¹é‡æ–‡ä»¶ä¸Šä¼  | éœ€è¦è®¤è¯ |
| GET | `/{file_id}` | è·å–æ–‡ä»¶è¯¦æƒ… | éœ€è¦æƒé™ |
| PUT | `/{file_id}` | æ›´æ–°æ–‡ä»¶ä¿¡æ¯ | éœ€è¦æƒé™ |
| DELETE | `/{file_id}` | åˆ é™¤æ–‡ä»¶ | éœ€è¦æƒé™ |
| GET | `/{file_id}/download` | ä¸‹è½½æ–‡ä»¶ | éœ€è¦æƒé™ |

**æ–‡ä»¶æœç´¢**

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | æƒé™ |
|------|------|------|------|
| GET | `/search` | æœç´¢æ–‡ä»¶ | éœ€è¦è®¤è¯ |

**æ–‡ä»¶å¤¹ç®¡ç†**

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | æƒé™ |
|------|------|------|------|
| POST | `/folders` | åˆ›å»ºæ–‡ä»¶å¤¹ | éœ€è¦è®¤è¯ |
| GET | `/folders/tree` | è·å–æ–‡ä»¶å¤¹æ ‘ | éœ€è¦è®¤è¯ |
| GET | `/folders/{folder_id}/files` | è·å–æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ | éœ€è¦æƒé™ |

**æ–‡ä»¶åˆ†äº«**

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | æƒé™ |
|------|------|------|------|
| POST | `/{file_id}/share` | åˆ†äº«æ–‡ä»¶ | éœ€è¦æƒé™ |
| GET | `/{file_id}/shares` | è·å–åˆ†äº«åˆ—è¡¨ | éœ€è¦æƒé™ |
| GET | `/shared-with-me` | è·å–åˆ†äº«ç»™æˆ‘çš„æ–‡ä»¶ | éœ€è¦è®¤è¯ |

**ç»Ÿè®¡ä¿¡æ¯**

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | æƒé™ |
|------|------|------|------|
| GET | `/statistics/overview` | æ–‡ä»¶ç»Ÿè®¡æ¦‚è§ˆ | éœ€è¦è®¤è¯ |
| GET | `/statistics/user` | ç”¨æˆ·æ–‡ä»¶ç»Ÿè®¡ | éœ€è¦è®¤è¯ |

**åˆ†ç±»å’Œæ ‡ç­¾ (å³å°†ä¸Šçº¿)**

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | æƒé™ |
|------|------|------|------|
| GET | `/categories` | è·å–åˆ†ç±»åˆ—è¡¨ | éœ€è¦è®¤è¯ |
| POST | `/categories` | åˆ›å»ºåˆ†ç±» | éœ€è¦è®¤è¯ |
| GET | `/categories/tree` | è·å–åˆ†ç±»æ ‘ | éœ€è¦è®¤è¯ |
| GET | `/tags` | è·å–æ ‡ç­¾åˆ—è¡¨ | éœ€è¦è®¤è¯ |
| POST | `/tags` | åˆ›å»ºæ ‡ç­¾ | éœ€è¦è®¤è¯ |
| POST | `/{file_id}/tags` | ä¸ºæ–‡ä»¶æ·»åŠ æ ‡ç­¾ | éœ€è¦æƒé™ |

### ğŸ” æœç´¢å‚æ•°è¯´æ˜

**æ–‡ä»¶æœç´¢æ”¯æŒçš„å‚æ•°**:
- `keyword`: å…³é”®è¯æœç´¢ (æ–‡ä»¶åã€æ ‡é¢˜ã€æè¿°)
- `file_type`: æ–‡ä»¶ç±»å‹è¿‡æ»¤ (document, image, video ç­‰)
- `mime_type`: MIMEç±»å‹è¿‡æ»¤
- `folder_id`: æŒ‡å®šæ–‡ä»¶å¤¹ID
- `category`: æ–‡ä»¶åˆ†ç±»è¿‡æ»¤
- `tags`: æ ‡ç­¾æ•°ç»„è¿‡æ»¤
- `tag_ids`: æ ‡ç­¾IDæ•°ç»„è¿‡æ»¤
- `visibility`: å¯è§æ€§è¿‡æ»¤ (private, public ç­‰)
- `created_from/created_to`: åˆ›å»ºæ—¶é—´èŒƒå›´
- `min_size/max_size`: æ–‡ä»¶å¤§å°èŒƒå›´
- `sort_by`: æ’åºå­—æ®µ (created_at, file_size, download_count)
- `sort_order`: æ’åºæ–¹å¼ (asc, desc)
- `page/per_page`: åˆ†é¡µå‚æ•°

**ç¤ºä¾‹è¯·æ±‚**:
```bash
GET /api/files/search?keyword=æŠ¥å‘Š&file_type=document&sort_by=created_at&sort_order=desc&page=1&per_page=20
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

1. **å®‰è£…ä¾èµ–**
```bash
pip install -r requirements.txt
```

2. **å¯åŠ¨å¤–éƒ¨æœåŠ¡**
```bash
# åªå¯åŠ¨æ•°æ®åº“å’Œä¸­é—´ä»¶æœåŠ¡
docker-compose up postgres redis minio weaviate -d
```

3. **è¿è¡Œåº”ç”¨**
```bash
# å¼€å‘æ¨¡å¼è¿è¡Œ
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### æ•°æ®åº“è¿ç§»

```bash
# åˆ›å»ºè¿ç§»æ–‡ä»¶
alembic revision --autogenerate -m "æè¿°"

# åº”ç”¨è¿ç§»
alembic upgrade head
```

### Celery ä»»åŠ¡

```bash
# å¯åŠ¨ Worker
celery -A app.celery worker --loglevel=info

# å¯åŠ¨ Beat (å®šæ—¶ä»»åŠ¡)
celery -A app.celery beat --loglevel=info

# æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€
celery -A app.celery flower
```

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### Docker ç›¸å…³

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f app

# é‡å¯åº”ç”¨æœåŠ¡
docker-compose restart app

# è¿›å…¥åº”ç”¨å®¹å™¨
docker-compose exec app bash

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# å®Œå…¨æ¸…ç† (åŒ…æ‹¬æ•°æ®å·)
docker-compose down -v
```

### æ•°æ®åº“ç›¸å…³

```bash
# è¿æ¥æ•°æ®åº“
docker-compose exec postgres psql -U chatx_user -d chatx_db

# å¤‡ä»½æ•°æ®åº“
docker-compose exec postgres pg_dump -U chatx_user chatx_db > backup.sql

# æ¢å¤æ•°æ®åº“
docker-compose exec -T postgres psql -U chatx_user -d chatx_db < backup.sql
```

### Redis ç›¸å…³

```bash
# è¿æ¥ Redis
docker-compose exec redis redis-cli

# æŸ¥çœ‹æ‰€æœ‰é”®
docker-compose exec redis redis-cli keys "*"

# æ¸…ç©ºç¼“å­˜
docker-compose exec redis redis-cli flushall
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                   # FastAPI åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ celery.py                # Celery é…ç½®
â”‚   â”œâ”€â”€ api/                     # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ auth_api.py          # è®¤è¯ç›¸å…³ API
â”‚   â”‚   â”œâ”€â”€ users_api.py         # ç”¨æˆ·ç®¡ç† API
â”‚   â”‚   â””â”€â”€ file_management_api.py # ä¼ä¸šçº§æ–‡ä»¶ç®¡ç† API
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py            # åº”ç”¨é…ç½®
â”‚   â”‚   â”œâ”€â”€ database.py          # æ•°æ®åº“é…ç½®
â”‚   â”‚   â”œâ”€â”€ security.py          # å®‰å…¨è®¤è¯
â”‚   â”‚   â”œâ”€â”€ redis.py             # Redis å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ minio_client.py      # MinIO å¯¹è±¡å­˜å‚¨å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ weaviate_client.py   # Weaviate å‘é‡æ•°æ®åº“å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ neo4j_client.py      # Neo4j å›¾æ•°æ®åº“å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ models/                  # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ user_models.py       # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â””â”€â”€ file_models.py       # æ–‡ä»¶ç®¡ç†æ¨¡å‹ (File/Folder/Category/Tagç­‰)
â”‚   â”œâ”€â”€ schemas/                 # Pydantic æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ user_schemas.py      # ç”¨æˆ·ç›¸å…³æ¨¡å¼
â”‚   â”‚   â””â”€â”€ file_schemas.py      # æ–‡ä»¶ç®¡ç†ç›¸å…³æ¨¡å¼
â”‚   â”œâ”€â”€ services/                # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â””â”€â”€ file_service.py      # æ–‡ä»¶ç®¡ç†æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ tasks/                   # Celery å¼‚æ­¥ä»»åŠ¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ user_tasks.py        # ç”¨æˆ·ç›¸å…³ä»»åŠ¡
â”‚   â””â”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ deps.py              # ä¾èµ–æ³¨å…¥
â”œâ”€â”€ nginx/                       # Nginx é…ç½®
â”‚   â”œâ”€â”€ nginx.conf               # å¼€å‘ç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ nginx-ssl.conf           # ç”Ÿäº§ç¯å¢ƒ SSL é…ç½®
â”œâ”€â”€ docker-compose.yml           # å¼€å‘ç¯å¢ƒ Docker ç¼–æ’
â”œâ”€â”€ docker-compose.prod.yml      # ç”Ÿäº§ç¯å¢ƒ Docker ç¼–æ’
â”œâ”€â”€ Dockerfile                   # Docker æ„å»ºé…ç½®
â”œâ”€â”€ requirements.txt             # Python åŸºç¡€ä¾èµ–
â”œâ”€â”€ requirements-dev.txt         # å¼€å‘ç¯å¢ƒä¾èµ–
â”œâ”€â”€ alembic.ini                  # æ•°æ®åº“è¿ç§»é…ç½®
â”œâ”€â”€ .env.example                # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ start.sh                    # å¼€å‘ç¯å¢ƒå¯åŠ¨è„šæœ¬
â”œâ”€â”€ start-prod.sh               # ç”Ÿäº§ç¯å¢ƒå¯åŠ¨è„šæœ¬
â”œâ”€â”€ dev-start.sh                # æœ¬åœ°å¼€å‘å¯åŠ¨è„šæœ¬
â”œâ”€â”€ generate-ssl.sh             # SSLè¯ä¹¦ç”Ÿæˆè„šæœ¬
â”œâ”€â”€ create_tables.py            # æ•°æ®åº“è¡¨åˆ›å»ºè„šæœ¬
â””â”€â”€ README.md                   # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

### ğŸ“Š æ•°æ®åº“æ¨¡å‹æ¶æ„

**ç”¨æˆ·ç®¡ç†**
- `User` - ç”¨æˆ·åŸºç¡€ä¿¡æ¯

**æ–‡ä»¶ç®¡ç†æ ¸å¿ƒ**
- `File` - æ–‡ä»¶ä¿¡æ¯è¡¨ (å¢å¼ºç‰ˆï¼Œæ”¯æŒåˆ†ç±»ã€æ ‡ç­¾ã€æƒé™)
- `Folder` - æ–‡ä»¶å¤¹å±‚çº§ç»“æ„è¡¨
- `FileVersion` - æ–‡ä»¶ç‰ˆæœ¬å†å²è¡¨
- `FileActivity` - æ–‡ä»¶æ“ä½œæ—¥å¿—è¡¨

**åˆ†ç±»å’Œæ ‡ç­¾ç³»ç»Ÿ**
- `FileCategory` - æ–‡ä»¶åˆ†ç±»è¡¨ (æ”¯æŒå±‚çº§)
- `FileTag` - æ–‡ä»¶æ ‡ç­¾è¡¨
- `FileTagRelation` - æ–‡ä»¶æ ‡ç­¾å…³è”è¡¨

**åˆ†äº«å’Œåä½œ**
- `FileShare` - æ–‡ä»¶åˆ†äº«é…ç½®è¡¨
- `FileComment` - æ–‡ä»¶è¯„è®ºè¡¨

**ç´¢å¼•ä¼˜åŒ–**
- å¤åˆç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
- å…¨æ–‡æœç´¢ç´¢å¼•
- åˆ†ç±»å’Œæ ‡ç­¾æŸ¥è¯¢ä¼˜åŒ–

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- **Nginx å®‰å…¨å±‚**: ç»Ÿä¸€å…¥å£ã€éšè—å†…éƒ¨æœåŠ¡ã€é˜²æŠ¤æ”»å‡»
- **SSL/HTTPS**: æ•°æ®ä¼ è¾“åŠ å¯†ã€è¯ä¹¦ç®¡ç†
- **å®‰å…¨å¤´è®¾ç½®**: XSS ä¿æŠ¤ã€å†…å®¹ç±»å‹å—…æ¢é˜²æŠ¤
- JWT è®¿é—®ä»¤ç‰Œ + åˆ·æ–°ä»¤ç‰Œæœºåˆ¶
- å¯†ç åŠ å¯†å­˜å‚¨ (bcrypt)
- ç”¨æˆ·æƒé™åˆ†çº§ (æ™®é€šç”¨æˆ·/è¶…çº§ç”¨æˆ·)
- æ–‡ä»¶è®¿é—®æƒé™æ§åˆ¶
- CORS è·¨åŸŸé…ç½®
- è¯·æ±‚é€Ÿç‡é™åˆ¶ (å¯é…ç½®)
- SQL æ³¨å…¥é˜²æŠ¤

## ğŸš€ Nginx çš„ä¼˜åŠ¿

### æ€§èƒ½ä¼˜åŒ–
- **é™æ€æ–‡ä»¶æœåŠ¡**: é«˜æ•ˆå¤„ç† CSSã€JSã€å›¾ç‰‡ç­‰é™æ€èµ„æº
- **Gzip å‹ç¼©**: å‡å°‘ä¼ è¾“æ•°æ®é‡ï¼Œæå‡åŠ è½½é€Ÿåº¦
- **è¿æ¥å¤ç”¨**: Keep-Alive è¿æ¥å‡å°‘æ¡æ‰‹å¼€é”€
- **ç¼“å­˜æ§åˆ¶**: æµè§ˆå™¨ç¼“å­˜ä¼˜åŒ–ï¼Œå‡å°‘é‡å¤è¯·æ±‚

### è´Ÿè½½å‡è¡¡
- **å¤šå®ä¾‹æ”¯æŒ**: å¯é…ç½®å¤šä¸ªåç«¯å®ä¾‹å®ç°é«˜å¯ç”¨
- **å¥åº·æ£€æŸ¥**: è‡ªåŠ¨æ£€æµ‹åç«¯æœåŠ¡çŠ¶æ€
- **æ•…éšœè½¬ç§»**: è‡ªåŠ¨åˆ‡æ¢åˆ°å¥åº·çš„åç«¯å®ä¾‹

### ç»Ÿä¸€ç®¡ç†
- **å•ä¸€å…¥å£**: æ‰€æœ‰æœåŠ¡é€šè¿‡ç»Ÿä¸€åŸŸåè®¿é—®
- **è·¯å¾„è·¯ç”±**: æ™ºèƒ½è·¯ç”±ä¸åŒæœåŠ¡ (/api â†’ åç«¯, /minio â†’ æ–‡ä»¶æœåŠ¡)
- **åè®®å‡çº§**: HTTP è‡ªåŠ¨é‡å®šå‘åˆ° HTTPS
- **æ—¥å¿—é›†ä¸­**: ç»Ÿä¸€çš„è®¿é—®æ—¥å¿—å’Œé”™è¯¯æ—¥å¿—

### å®‰å…¨é˜²æŠ¤
- **éšè—åç«¯**: å®¢æˆ·ç«¯æ— æ³•ç›´æ¥è®¿é—®å†…éƒ¨æœåŠ¡
- **SSL ç»ˆç»“**: åœ¨ Nginx å±‚å¤„ç† HTTPSï¼Œå‡è½»åç«¯è´Ÿæ‹…
- **è®¿é—®æ§åˆ¶**: IP é™åˆ¶ã€é€Ÿç‡é™åˆ¶
- **å®‰å…¨å¤´**: è‡ªåŠ¨æ·»åŠ å®‰å…¨ç›¸å…³çš„ HTTP å¤´

## ğŸ› æ•…éšœæ’é™¤

### æœåŠ¡å¯åŠ¨å¤±è´¥

1. æ£€æŸ¥ç«¯å£å ç”¨: `lsof -i :8000`
2. æŸ¥çœ‹æœåŠ¡æ—¥å¿—: `docker-compose logs æœåŠ¡å`
3. æ£€æŸ¥ç£ç›˜ç©ºé—´: `df -h`
4. é‡å¯ Docker: `sudo systemctl restart docker`

### æ•°æ®åº“è¿æ¥å¤±è´¥

1. æ£€æŸ¥æ•°æ®åº“çŠ¶æ€: `docker-compose ps postgres`
2. éªŒè¯è¿æ¥é…ç½®: æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `DATABASE_URL`
3. æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—: `docker-compose logs postgres`

### æ–‡ä»¶ä¸Šä¼ å¤±è´¥

1. æ£€æŸ¥ MinIO çŠ¶æ€: `docker-compose ps minio`
2. éªŒè¯å­˜å‚¨ç©ºé—´: è®¿é—® MinIO æ§åˆ¶å°
3. æ£€æŸ¥æ–‡ä»¶å¤§å°é™åˆ¶: æŸ¥çœ‹ `.env` ä¸­çš„ `MAX_FILE_SIZE`

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. Docker å’Œ Docker Compose ç‰ˆæœ¬
2. ç«¯å£å ç”¨æƒ…å†µ
3. ç¯å¢ƒå˜é‡é…ç½®
4. æœåŠ¡æ—¥å¿—è¾“å‡º

## ğŸš§ å¼€å‘è·¯çº¿å›¾

### ğŸ”¥ å³å°†å‘å¸ƒ (v1.1)

- [ ] æ–‡ä»¶åˆ†ç±»å’Œæ ‡ç­¾APIæ¥å£å®Œå–„
- [ ] æ–‡ä»¶å†…å®¹æå–å’Œå‘é‡åŒ–æœç´¢
- [ ] æ–‡ä»¶ç¼©ç•¥å›¾ç”Ÿæˆ
- [ ] æ‰¹é‡æ–‡ä»¶æ“ä½œä¼˜åŒ–

### ğŸ“‹ è®¡åˆ’ä¸­åŠŸèƒ½ (v1.2+)

**æ–‡ä»¶ç®¡ç†å¢å¼º**
- [ ] æ–‡ä»¶åœ¨çº¿é¢„è§ˆ (æ”¯æŒå¸¸è§æ ¼å¼)
- [ ] æ–‡ä»¶åä½œç¼–è¾‘
- [ ] æ–‡ä»¶æ”¶è—å’Œä¸ªäººç©ºé—´
- [ ] æ–‡ä»¶å›æ”¶ç«™åŠŸèƒ½
- [ ] æ–‡ä»¶å‹ç¼©å’Œè§£å‹ç¼©

**ç³»ç»ŸåŠŸèƒ½**
- [ ] é‚®ä»¶æœåŠ¡é›†æˆ
- [ ] çŸ­ä¿¡éªŒè¯åŠŸèƒ½  
- [ ] OAuth ç¬¬ä¸‰æ–¹ç™»å½• (å¾®ä¿¡ã€QQã€GitHubç­‰)
- [ ] API é€Ÿç‡é™åˆ¶å’Œé˜²æ»¥ç”¨
- [ ] ç³»ç»Ÿç›‘æ§å’Œæ—¥å¿—æ”¶é›†
- [ ] è‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–
- [ ] API ç‰ˆæœ¬æ§åˆ¶

**æ€§èƒ½å’Œå®‰å…¨**
- [ ] æ•°æ®åŠ å¯†ä¼ è¾“
- [ ] æ–‡ä»¶è®¿é—®å®¡è®¡
- [ ] è‡ªåŠ¨å¤‡ä»½ç­–ç•¥
- [ ] CDN é›†æˆä¼˜åŒ–
- [ ] å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ 
- [ ] æ–­ç‚¹ç»­ä¼ æ”¯æŒ

**ä¼ä¸šçº§åŠŸèƒ½**
- [ ] å¤šç§Ÿæˆ·æ”¯æŒ
- [ ] å·¥ä½œæµå’Œå®¡æ‰¹
- [ ] è¯¦ç»†æƒé™ç®¡ç†
- [ ] æ•°æ®åˆ†ææŠ¥è¡¨
- [ ] ç¬¬ä¸‰æ–¹é›†æˆAPI
- [ ] ç§»åŠ¨ç«¯APIä¼˜åŒ–